$(document).ready(function () { function n(a, t) { return new Promise(e => { Swal.fire({ position: "top-end", icon: t, title: a, showConfirmButton: !1, timer: 1500, iconColor: "#149414", confirmButtonColor: "#149414", background: "black" }).then(a => { e() }) }) } TokenAcc().then(function (a) { var i = a.accessToken, d = $("#emaildata").DataTable({ ajax: { url: api_uri + "/api/v1/situs/data", method: "GET", headers: { Authorization: "Bearer " + i }, dataType: "json", success: function (a) { var s, l; a = a, (s = $("#emaildata").DataTable()).clear(), l = 0, $.each(a, function (a, e) { e.status; var t = '<button class="link-ss" data-bs-toggle="modal" data-bs-target="#view_gambar" data-id="' + e._id + '">View</button>', o = "$" + e.earning, i = '<button class="link-hapus" id="' + e._id + '">HAPUS</button>|<button class="edit bg-none-green" data-bs-toggle="modal" data-bs-target="#editmodal" data-id="' + e._id + '">Edit</button>|<button type="button" class="note bg-note" data-bs-toggle="modal" data-bs-target="#dataModal" data-id="' + e._id + '">NOTE</button>'; s.row.add([++l, e.situs, e.email, o, t, i]) }), s.draw() }, error: function () { n("Error retrieving data", "error") } }, ordering: !0, paging: !0, searching: !0, lengthChange: !1, pageLength: 5, responsive: !0, pagingType: "simple", autoWidth: !0 }); $("#add-site").submit(function (a) { a.preventDefault(); var e = $("#loading"), a = (e.addClass("disabled").attr("disabled", !0).val("Please wait..."), new FormData(this)), t = $("#siteInput").val(), o = $("#emailInput").val(), i = $("#file-input").val(), s = $("#nohpInput").val(), l = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; $(""), l.test(o) && "" !== o && "" !== t && "" !== i && "" !== s ? $.ajax({ url: "../core/nead_core.php", type: "POST", data: a, contentType: !1, processData: !1, success: function (a) { d.ajax.reload(null, !1), n("Your file has been added.", "success").then(() => { $("#add-site")[0].reset(), $("#file-label").text("Choose file"), $("#image-preview").hide(), e.removeClass("disabled").attr("disabled", !1).val("Add Site") }) }, error: function (a, e, t) { console.log(a.responseText) } }) : (n(l.test(o) ? "All fields are required!" : "Email is not valid!", "error"), e.removeClass("disabled").attr("disabled", !1).val("Add Site")) }), $(".modal").on("shown.bs.modal", function (a) { var t = $(a.relatedTarget).data("id"), o = $(this).attr("id"); if ("inputdata" === o) return !1; $.ajax({ url: api_uri + "/api/v1/situs/data/" + t, type: "GET", headers: { Authorization: "Bearer " + i }, success: function (a) { var e; "view_gambar" === o ? ($("#img_modal").html('<img class="hello_img" src="' + a.ss + '">'), $("#view_gambar").modal("show")) : "dataModal" === o ? (e = a.createdAt, e = new Date(e).toLocaleDateString("id-ID", { weekday: "long", year: "numeric", month: "long", day: "numeric", hour: "2-digit", minute: "2-digit", second: "2-digit" }), $("#your_modal_detail").html(a.note), $("#your_modal_date").html(e), $("#dataModal").modal("show")) : "editmodal" === o && ($("#modal_situs").val(a.situs), $("#modal_email").val(a.email), $("#modal_earning").val(a.earning), $("#modal_note").val(a.note), $("#image-preview-2").attr("src", a.ss), $("#id-edit").val(t), $("#img-scr").val(a.ss), $("#editmodal").modal("show"), $("#loading-2").removeClass("disabled").attr("disabled", !1).val("Save Changes")) }, error: function (a, e, t) { console.log(a.responseText) } }) }), $("#edit-site").submit(function (a) { a.preventDefault(); var a = $("#loading-2"), e = (a.addClass("disabled").attr("disabled", !0).val("Please wait..."), new FormData(this)), t = $("#modal_email").val(), o = $("#modal_password").val(), i = $("#modal_nohp").val(), s = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; s.test(t) && "" !== t && "" !== o && "" !== i ? $.ajax({ url: "../core/nead_core.php", type: "POST", data: e, contentType: !1, processData: !1, success: function (a) { d.ajax.reload(null, !1), n("Your file has been edited.", "success").then(() => { $("#editmodal").modal("hide"), $(".modal-backdrop.fade.show").removeClass("modal-backdrop").addClass("haibeb") }) }, error: function (a, e, t) { console.log(a.responseText) } }) : (n(s.test(t) ? "All fields are required!" : "Email is not valid!", "error"), a.removeClass("disabled").attr("disabled", !1).val("Save Changes")) }), $(document).on("click", ".link-hapus", function () { var e = $(this).attr("id"); Swal.fire({ title: "Are you sure?", text: "You won't be able to revert this!", icon: "warning", iconColor: "#149414", background: "black", showCancelButton: !0, confirmButtonColor: "#149414", cancelButtonColor: "transparent", confirmButtonText: "Yes, delete it!" }).then(a => { a.isConfirmed && $.ajax({ url: api_uri + "/api/v1/situs/data/" + e, type: "DELETE", headers: { Authorization: "Bearer " + i }, success: function () { d.ajax.reload(null, !1), n("Your file has been deleted.", "success") } }) }) }), setInterval(function () { d.ajax.reload(null, !1) }, 2e4), new $.fn.dataTable.FixedHeader(d) }).catch(function (a) { console.log(a) }) });